(function(window){
 var _conf={"storageBucket":"la-vanguardia.appspot.com","urlServiceWorker":"https://www.lavanguardia.com/_nickel/js/firebase-messaging-sw.js","unSubscribeTokenToTopic":"https://us-central1-la-vanguardia.cloudfunctions.net/unSubscribeTokenToTopic","vapidKey":"BFh7XEICRRAGZppcI9lVcGn0KLXF0wqI4rQBf0tPcZ0X4O1wtZCn2rEkj-nBpABEK0M39vzxP_xCdxaFDNZeTCc","apiKey":"AIzaSyBcF6gEkAldP9fsRREIUK_cetclYBw9sk0","messagingSenderId":"766792178111","appId":"1:766792178111:web:ce5fcd53c39a480e35a90a","subscribeTokenToTopic":"https://us-central1-la-vanguardia.cloudfunctions.net/subscribeTokenToTopic","projectId":"la-vanguardia","databaseURL":"https://la-vanguardia.firebaseio.com","authDomain":"la-vanguardia.firebaseapp.com"};
gg.firebaseWebpush=function(){var e,t,n={logoUrl:"https://www.lavanguardia.com/rsc/images/lv-logo.svg?v=d4b9534cd31e3a54cd3f8fb61d26945ba9ffe14e",text:"¿Quieres recibir las últimas noticias en tu navegador?",unSuscribedText:"Ya estás suscrito a las alertas. ¿Quieres dejar de recibir las últimas noticias en tu navegador?",acceptText:"Sí, acepto",acceptUnSuscribedText:"Darme de baja",denyText:"Ahora no",expirationDays:15,closeDelay:1e4,brandColor:"#001c4c",behaviour:"default",subscribeTextPermission:"Suscríbete a las alertas clicando en 'Permitir' a través de la configuración de tu navegador.",subscribeText:"Suscríbete a las alertas clicando en 'Permitir'.",unsubscribedText:"Ya te has dado de baja de las alertas"},o=!1,i=(window.localStorage,"GG_PUSH_PERMISSION"),r=function(t){e=function(e,t){var o,i={};for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o]);for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o]);return i}(0,t);var r=c(i);void 0!==navigator.permissions&&navigator.permissions.query({name:"notifications"}).then((t=>{if("alert"===e.behaviour&&(f(),b(e),l()),"default"===e.behaviour){if("denied"===t.state)return;"granted"===t.state?(r||a(i,{interaction:"accepted",date:new Date}),"accepted"===r.interaction&&(o||(h(),o=!0))):(!r||r&&"denied"===r.interaction&&s(e,r.date))&&(f(),b(e),l())}}))},a=function(e,t){localStorage.setItem(e,JSON.stringify(t))},c=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null},s=function(e,t){var n=new Date,o=new Date(t),r=n.getTime()-o.getTime();return Math.ceil(r/864e5)>=e.expirationDays&&(localStorage.removeItem(i),!0)},l=function(){var e=document.querySelector(".gg--acceptLink"),t=document.querySelector(".gg--denyLink"),n=document.querySelector("#gg-alert-close");e.addEventListener("click",(function(){u()})),t.addEventListener("click",(function(){p()})),n.addEventListener("click",(function(){p()}))},d=function(){m();var n=document.querySelector("#gg-alert-buttons");document.querySelector(".lv-webpush-text-textalert").innerText=e.unsubscribedText,n.parentNode.removeChild(n),t=setTimeout(g,e.closeDelay)},g=function(){var e,t,n;e=document.querySelector(".gg--acceptLink"),t=document.querySelector(".gg--denyLink"),n=document.querySelector("#gg-alert-close"),e&&e.removeEventListener("click",u,!0),t&&t.removeEventListener("click",p,!0),n&&n.removeEventListener("click",p,!0);var o=document.querySelector("#gg-alert");o&&o.parentNode.removeChild(o);var i=document.querySelector("[data-gg-alert]");i&&i.parentNode.removeChild(i)},u=function(){navigator.permissions.query({name:"notifications"}).then((t=>{var n,i;"granted"===t.state?(o||(h(),o=!0),v(),g()):(n=document.querySelector("#gg-alert-buttons"),i=document.querySelector(".lv-webpush-text-textalert"),"denied"===Notification.permission?i.innerText=e.subscribeTextPermission:i.innerText=e.subscribeText,n.parentNode.removeChild(n),o||(h(),o=!0))}))},p=function(){g(),a(i,{interaction:"denied",date:new Date})},b=function(e){var t=`\n       <div>\n    <div class='lv-webpush'>\n       <div id="gg-alert-body">\n          <a id="gg-alert-close" class="gg--closeLink"></a>\n          <figure class='lv-webpush-logo' style='background-color:${e.brandColor}'> <img itemprop='logo' src='${e.logoUrl}' rel='logo'></figure>\n          <div class='lv-webpush-text'>\n             <div class='lv-webpush-text-alert'> <i class='fa fa-bell' aria-hidden='true'></i> </div>\n             <div class='lv-webpush-text-textalert'>${e.text}</div>\n          </div>\n       </div>\n       <div id="gg-alert-buttons">\n          <a class="gg-alert-button\n             gg-alert-success\n             gg--acceptLink\n             gg--acceptContent">${e.acceptText}</a>\n          <a class="gg-alert-button\n             gg-alert-error\n             gg--denyLink\n             gg--denyContent">${e.denyText}</a>\n       </div>\n    </div> `;alertsPopupContainer=document.createElement("div"),alertsPopupContainer.id="gg-alert",alertsPopupContainer.innerHTML=t,document.body.insertBefore(this.alertsPopupContainer,document.body.firstChild)},f=function(){var e=document.createElement("style");e.textContent="\n                #gg-alert{top:80px;z-index:6000001!important;width:400px;height:auto;min-height:150px;border-radius:4px;position:fixed;background:#fbfbfb;box-shadow:0 1px 4px rgb(0 0 0 / 30%);overflow:hidden;font-family:Arial,Helvetica,sans-serif;right:initial!important;left:10px!important}#gg-alert-body{width:100%;padding:25px 20px 10px 20px;position:relative;height:auto;z-index:1;margin-bottom:50px}#gg-alert-close{position:absolute;top:6px;right:5px;height:12px;width:12px;opacity:.5;z-index:2;cursor:pointer}#gg-alert-close:after,#gg-alert-close:before{position:absolute;left:3px;content:\" \";width:2px;background-color:#000;height:13px}#gg-alert-close:before{transform:rotate(45deg)}#gg-alert-close:after{transform:rotate(-45deg)}#gg-alert-buttons{width:100%;position:absolute;bottom:0;height:50px;text-align:center;line-height:45px}#gg-alert-buttons .gg--acceptLink{background:#4eb669;border-bottom:2px solid #179b53}#gg-alert-buttons a{height:35px;line-height:35px;padding:0 8px;width:auto;position:relative;display:inline-block;min-width:84px;text-align:center;border-radius:3px;text-decoration:none;color:#fff;margin-right:10px;text-shadow:0 2px rgb(0 0 0 / 20%);cursor:pointer}#gg-alert-buttons .gg--denyLink{background:#ccc;border-bottom:2px solid #aaa;color:#444;text-shadow:none}#gg-alert-buttons a:last-child{margin-right:0}.lv-webpush-logo{margin:5px 0 20px 60px;max-width:235px;padding:15px 24px 10px;box-sizing:border-box}.lv-webpush-logo img{width:100%}.lv-webpush-text{position:relative;min-height:50px}.lv-webpush-text-alert{background:#248ccb;font-size:16px;color:#fff;text-align:center;border-radius:50%;position:absolute;height:50px;width:50px;display:flex;justify-content:center;align-items:center}.lv-webpush-text-textalert{font:12px Arial,'Helvetica Neue',Helvetica,sans-serif;font-weight:900;color:#248ccb;padding-right:45px;padding-left:65px}#gg-alert{z-index:6000001!important}@media (min-width:1024px){#gg-alert{top:80px}}\n            ",e.setAttribute("data-gg-alert","true"),document.getElementsByTagName("head")[0].appendChild(e)},h=function(){var e={apiKey:_conf.apiKey,authDomain:_conf.authDomain,databaseURL:_conf.databaseURL,projectId:_conf.projectId,storageBucket:_conf.storageBucket,messagingSenderId:_conf.messagingSenderId,appId:_conf.appId};firebase.initializeApp(e);const t=firebase.messaging();navigator.serviceWorker.register(_conf.urlServiceWorker).then((e=>{t.useServiceWorker(e),v(),t.onMessage((function(e){if(!document.hidden){const n=e.notification,o=n.title,i={body:n.body,icon:n.icon,image:n.image,data:{url:function(e){try{var t=new URL(e);"http:"!=t.protocol&&"https:"!=t.protocol&&(t.protocol="https:"),e=t.toString()}catch(e){console.log("Not an URL")}return e}(n.click_action)}};var t=new Notification(o,i);t.onclick=e=>{t.close(),window.open(i.data.url,"_blank")}}}))}))},v=function(){const e=firebase.messaging(),t=async()=>{e.getToken({vapidKey:_conf.vapidKey}).then((e=>{var t;t=e,fetch(_conf.subscribeTokenToTopic+"?token="+t,{mode:"no-cors"}).then((e=>{console.log("Subscribed to topic")})).catch((e=>{console.error("Error subscribing")})),a(i,{interaction:"accepted",date:new Date}),g()})).catch((e=>{"messaging/token-unsubscribe-failed"===e.code?t():(console.log("An error occurred while retrieving token. ",e),g(),navigator.permissions.query({name:"notifications"}).then((e=>{"denied"===e.state&&a(i,{interaction:"denied",date:new Date})})))}))};t()},m=function(){const e=firebase.messaging(),t=async()=>{e.getToken({vapidKey:_conf.vapidKey}).then((e=>{var t;t=e,fetch(_conf.unSubscribeTokenToTopic+"?token="+t,{mode:"no-cors"}).then((e=>{console.log("UnSubscribed to topic")})).catch((e=>{console.error("Error unsubscribing")})),a(i,{interaction:"denied",date:new Date})})).catch((e=>{"messaging/token-unsubscribe-failed"===e.code?t():(console.log("An error occurred while retrieving token. ",e),g(),navigator.permissions.query({name:"notifications"}).then((e=>{"denied"===e.state&&a(i,{interaction:"denied",date:new Date})})))}))};t()};return{init:r,turnOffSuscription:m,turnOnSuscription:v,initShowAlerts:function(){var n,o,a,s=c(i);if(!s||s&&"denied"===s.interaction){var l={...e,behaviour:"alert"};r(l)}else{l={...e,text:e.unSuscribedText,acceptText:e.acceptUnSuscribedText};f(),b(l),n=document.querySelector(".gg--acceptLink"),o=document.querySelector(".gg--denyLink"),a=document.querySelector("#gg-alert-close"),n.addEventListener("click",(function(){d()})),o.addEventListener("click",(function(){g(),void 0!==t&&clearTimeout(t)})),a.addEventListener("click",(function(){g(),void 0!==t&&clearTimeout(t)}))}}}}();
})(window);